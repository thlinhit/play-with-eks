---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pynproc
  namespace: myns
spec:
  selector:
    matchLabels:
      app: pynproc
  replicas: 1
  template:
    metadata:
      labels:
        app: pynproc
        fargate: enable
    spec:
      containers:
        - name: pynproc
          image: '851725166193.dkr.ecr.us-east-1.amazonaws.com/pynproc:0.0.8'
#          command: ["/bin/bash", "-c", "echo 'ulimit -Sn 65535' >> /root/.bashrc && echo 'ulimit -Su 65535' >> /root/.bashrc && sleep 100 && ./home/worker/entrypoint.sh"]
#          volumeMounts:
#            - name: data
#              mountPath: /home/worker/.bashrc
##          command: ["/bin/bash", "-c", "echo 'ulimit -Sn 65535' >> /home/worker/.bashrc && echo 'ulimit -Su 65535' >> /home/worker/.bashrc && sleep 100"]
#      initContainers:
#        - name: init
#          image: ubuntu:18.04
#          command: ["/bin/bash", "-c", "adduser worker --disabled-password --gecos \"\" && echo 'ulimit -Sn 65535' >> /home/worker/.bashrc && echo 'ulimit -Su 65535' >> /home/worker/.bashrc && sleep 100"]
#          volumeMounts:
#            - name: data
#              mountPath: /home
      restartPolicy: Always
#      volumes:
#        - name: data
#          emptyDir: { }
---
apiVersion: v1
kind: Service
metadata:
  name: pynproc-dev
  namespace: myns
spec:
  type: NodePort
  selector:
    app: pynproc
  ports:
    - port: 8080
      nodePort: 32411
      protocol: TCP
      targetPort: 8080
